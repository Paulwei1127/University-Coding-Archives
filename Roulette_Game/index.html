<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <style>
     @import "style.css";
    </style>
  </head>
  <body>
    <div id="walletDisplay" style="font-size: large; font-weight: bold; color: white;">Wallet: 1000</div>

    <!---輪盤-->
    <input type="button" value="spin" style="float:left;" id='spin' />
    <canvas id="canvas" width="500" height="500"></canvas>

    <!--table-->
    <button class="Butt" onclick="toggleButtonColor(this,10)">$10</button>
    <button class="Butt" onclick="toggleButtonColor(this,50)">$50</button>
    <button class="Butt" onclick="toggleButtonColor(this,100)">$100</button>    
    <div class="bet-table">
        <div class="container-first">
            <div class="zero-item" onclick="handleClick(this)" id="0"><div class="value">0</div></div>
            <div class="red-item" onclick="handleClick(this)" id="1"><div class="value">1</div></div>
            <div class="black-item" onclick="handleClick(this)" id="2"><div class="value">2</div></div>
            <div class="red-item" onclick="handleClick(this)" id="3"><div class="value">3</div></div>
            <div class="black-item" onclick="handleClick(this)" id="4"><div class="value">4</div></div>
            <div class="red-item" onclick="handleClick(this)" id="5"><div class="value">5</div></div>
            <div class="black-item" onclick="handleClick(this)" id="6"><div class="value">6</div></div>
            <div class="red-item" onclick="handleClick(this)" id="7"><div class="value">7</div></div>
            <div class="black-item" onclick="handleClick(this)" id="8"><div class="value">8</div></div>
            <div class="red-item" onclick="handleClick(this)" id="9"><div class="value">9</div></div>
            <div class="black-item" onclick="handleClick(this)" id="10"><div class="value">10</div></div>
            <div class="black-item" onclick="handleClick(this)" id="11"><div class="value">11</div></div>
            <div class="red-item" onclick="handleClick(this)" id="12"> <div class="value">12</div></div>
            <div class="black-item" onclick="handleClick(this)" id="13"><div class="value">13</div></div>
            <div class="red-item" onclick="handleClick(this)" id="14"><div class="value">14</div></div>
            <div class="black-item" onclick="handleClick(this)" id="15"><div class="value">15</div></div>
            <div class="red-item" onclick="handleClick(this)" id="16"><div class="value">16</div></div>
            <div class="black-item" onclick="handleClick(this)" id="17"><div class="value">17</div></div>
            <div class="red-item" onclick="handleClick(this)" id="18"><div class="value">18</div></div>
            <div class="red-item" onclick="handleClick(this)" id="19"><div class="value">19</div></div>
            <div class="black-item" onclick="handleClick(this)" id="20"><div class="value">20</div></div>
            <div class="red-item" onclick="handleClick(this)" id="21"><div class="value">21</div></div>
            <div class="black-item" onclick="handleClick(this)" id="22"><div class="value">22</div></div>
            <div class="red-item" onclick="handleClick(this)" id="23"><div class="value">23</div></div>
            <div class="black-item" onclick="handleClick(this)" id="24"><div class="value">24</div></div>
            <div class="red-item" onclick="handleClick(this)" id="25"><div class="value">25</div></div>
            <div class="black-item" onclick="handleClick(this)" id="26"><div class="value">26</div></div>
            <div class="red-item" onclick="handleClick(this)" id="27"><div class="value">27</div></div>
            <div class="black-item" onclick="handleClick(this)" id="28"><div class="value">28</div></div>
            <div class="black-item" onclick="handleClick(this)" id="29"><div class="value">29</div></div>
            <div class="red-item" onclick="handleClick(this)" id="30"><div class="value">30</div></div>
            <div class="black-item" onclick="handleClick(this)" id="31"><div class="value">31</div></div>
            <div class="red-item" onclick="handleClick(this)" id="32"><div class="value">32</div></div>
            <div class="black-item" onclick="handleClick(this)" id="33"><div class="value">33</div></div>
            <div class="red-item" onclick="handleClick(this)" id="34"><div class="value">34</div></div>
            <div class="black-item" onclick="handleClick(this)" id="35"><div class="value">35</div></div>
            <div class="red-item" onclick="handleClick(this)" id="36"><div class="value">36</div></div>
            <div class="column-item" onclick="handleClick(this)" id="37"><div class="value">2-1</div></div>
            <div class="column-item" onclick="handleClick(this)" id="38"><div class="value">2-1</div></div>
            <div class="column-item" onclick="handleClick(this)" id="39"><div class="value">2-1</div></div>
        </div>
        <div class="container-second">
            <div class="doz-item" onclick="handleClick(this)" id="40">1st 12</div>
            <div class="doz-item" onclick="handleClick(this)" id="41">2nd 12</div>
            <div class="doz-item" onclick="handleClick(this)" id="42">3rd 12</div>
        </div>
        <div class="container-third">
            <div class="outside-section" onclick="handleClick(this)" id="43">1-18</div>
            <div class="outside-section" onclick="handleClick(this)" id="44">EVEN</div>
            <div class="outside-section" onclick="handleClick(this)" id="45"><div class="rhomb-red"></div></div>
            <div class="outside-section" onclick="handleClick(this)" id="46"><div class="rhomb-black"></div></div>
            <div class="outside-section" onclick="handleClick(this)" id="47">ODD</div>
            <div class="outside-section" onclick="handleClick(this)" id="48">19-36</div>
        </div>
    </div>
    <script>
        var wallet=1000;//總資產
        var Betable=[];//存賠率
        var Betrecord=[];//紀錄下注情形
        var Betcount = 0;//下注數目
        var won = 0 ;
        var chips = 10;
        var currentChip = 0; // 當前所選的籌碼面額
        var selectedNumbers = []; // 被選擇的數字或外部區域的列表
        var wallet_old = 0;//紀錄下注金額
        var selectedChipButton = null; // 用於跟蹤當前選擇的籌碼按鈕

        function initBetrecord()
        {
            for(i=0;i<49;i++){
                Betrecord[i]=0;
                selectedNumbers[i]=0;
            }
            currentChip = 0; // 初始化為 $10 面額
        }

        function setChip(chipValue) {//設置當前所選的籌碼面額
            currentChip = chipValue;
        }

        function handleClick(clickedDiv) {//下注
            // 獲取被點擊的div的id
            var id = parseInt(clickedDiv.id);

             // 在下注之前檢查錢包餘額
            if (wallet - currentChip < 0 && clickedDiv.style.backgroundColor !== 'white') {
                window.alert("錢包沒錢啦");
                // 取消這次點擊的效果，並退出函數
                return;
            }
            
            // 檢查目前的背景顏色，若為白色就還原，否則變成白色
            if (clickedDiv.style.backgroundColor === 'white') {
                // 還原原本的樣式
                clickedDiv.style.backgroundColor = ''; // 或者使用原始的顏色值
                clickedDiv.style.color = 'white'; // 還原文字顏色，根據實際情況修改
                wallet = wallet + selectedNumbers[id];
                Betrecord[id] = 0; // 將對應的 Betrecord[i] 的值設回0
                if( Betcount!=0 )Betcount -=selectedNumbers[id];
                selectedNumbers[id] = 0;
            } else {
                // 變成白色
                clickedDiv.style.backgroundColor = 'white';
                clickedDiv.style.color = 'black'; // 修改文字顏色，根據實際情況修改
                // 將對應的 Betrecord[i] 的值設為1
                Betrecord[id] = 1;
                wallet = wallet - currentChip;
                
                    selectedNumbers[id] = currentChip;
                Betcount+=selectedNumbers[id];
            }
            updateWalletDisplay();
        }

        function toggleButtonColor(button, chipValue) {
            // 如果已經選擇了籌碼，取消它的白色顏色
            if (selectedChipButton) {
                selectedChipButton.style.backgroundColor = '';
                selectedChipButton.style.color = 'white';
            }

            // 設置當前選擇的籌碼按鈕為新選擇的按鈕
            selectedChipButton = button;
            currentChip = chipValue;

            // 設置新選擇的籌碼按鈕為白色
            button.style.backgroundColor = 'white';
            button.style.color = 'black';
        }


        function cantBell(){
              // 创建弹出窗口，显示下注情况和获胜金额
              var Message = "You don't have enough money!" + "\n";
            // 显示弹出窗口
            window.alert(Message);
        }
        function updateWalletDisplay() {//更新資產顯示
            // 獲取顯示錢包的元素
            var walletDisplay = document.getElementById("walletDisplay");
            
            // 更新顯示的內容
            walletDisplay.textContent = "Wallet: " + wallet;
        }

        function Bet(spin_result){//處理結果
            wallet_old = wallet;
            won = 0;
            for(i=0;i<37;i++)			//猜中數字1:35
                Betable[i] = 36; 	
            for(i=37;i<=39;i++)			//橫排1:2	
                Betable[i] = 3;
            for(i=40;i<=42;i++)			//12個數字組合 1:2
                Betable[i] = 3;
            for(i=43;i<=48;i++)			//設定 1to18、奇偶、紅黑 1:1
                Betable[i] = 2;

            //wallet = wallet-Betcount*10;//扣掉賭金

            wallet = wallet + Betable[spin_result]*Betrecord[spin_result]*selectedNumbers[spin_result];//判別數字輸贏
            won +=  Betable[spin_result]*Betrecord[spin_result]*selectedNumbers[spin_result];

            //判斷1-12區間輸贏
            if(spin_result<=12 && spin_result>0){
                wallet = wallet + Betable[40]*Betrecord[40]*selectedNumbers[40];
                won += Betable[40]*Betrecord[40]*selectedNumbers[40];
            }
            else if(spin_result<=24 && spin_result>12){
                wallet = wallet + Betable[41]*Betrecord[41]*selectedNumbers[41];
                won += Betable[41]*Betrecord[41]*selectedNumbers[41];
            }
            else{
                wallet = wallet + Betable[42]*Betrecord[42]*selectedNumbers[42];
                won += Betable[42]*Betrecord[42]*selectedNumbers[42];
            }

            //判斷奇偶輸贏
            if( spin_result%2 == 0){//偶
                wallet = wallet + Betable[44]*Betrecord[44]*selectedNumbers[44];
                won += Betable[44]*Betrecord[44]*selectedNumbers[44];
            }//奇
            else {
                wallet = wallet + Betable[47]*Betrecord[47]*selectedNumbers[47];
                won += Betable[47]*Betrecord[47]*selectedNumbers[47];
            }
            //判斷黑紅
            //red
            if(spin_result==1||spin_result==3||spin_result==5||spin_result==7||spin_result==9||spin_result==12||
            spin_result==14||spin_result==16||spin_result==18||spin_result==19||spin_result==21||spin_result==23
            ||spin_result==25||spin_result==27||spin_result==30||spin_result==32||spin_result==34||spin_result==36){
                wallet = wallet + Betable[45]*Betrecord[45]*selectedNumbers[45];
                won += Betable[45]*Betrecord[45]*selectedNumbers[45];
            }
            else{
                wallet = wallet + Betable[46]*Betrecord[46]*selectedNumbers[46];
                won += Betable[46]*Betrecord[46]*selectedNumbers[46];
            }

            //判斷上下半
            if( 0 < spin_result || spin_result < 19){
                wallet = wallet + Betable[43]*Betrecord[43]*selectedNumbers[43];
                won += Betable[43]*Betrecord[43]*selectedNumbers[43];
            }
            else{
             wallet = wallet + Betable[48]*Betrecord[48]*selectedNumbers[48];
             won += Betable[48]*Betrecord[48]*selectedNumbers[48];
            }

            //判斷橫列輸贏
            if(spin_result%3==0){//第一列
                wallet = wallet + Betable[39]*Betrecord[39]*selectedNumbers[39];
                won += Betable[39]*Betrecord[39]*selectedNumbers[39];
            }
            else if(spin_result==2||spin_result==5||spin_result==8||spin_result==11||spin_result==14||spin_result==17||spin_result==20
            ||spin_result==20||spin_result==23||spin_result==26||spin_result==29||spin_result==32||spin_result==35){//第二列
                wallet = wallet + Betable[38]*Betrecord[38]*selectedNumbers[38];
                won += Betable[38]*Betrecord[38]*selectedNumbers[38];
            }
            else{
                 wallet = wallet + Betable[37]*Betrecord[37]*selectedNumbers[37];
                 won +=  Betable[37]*Betrecord[37]*selectedNumbers[37];
            }

            if(isNaN(wallet))wallet=wallet_old;
            if(isNaN(won))won=0;

            

             // 创建弹出窗口，显示下注情况和获胜金额
            var resultMessage = "You bet: " + Betcount + "\n";
            resultMessage += "You won: " + won + "\n";
            resultMessage += "Current wallet: " + wallet;

            // 显示弹出窗口
            window.alert(resultMessage);
            updateWalletDisplay()

            // 还原表格的下注状态为原始状态
            resetTable();
        }

        function resetTable() {
            // 还原下注记录数组
            initBetrecord();

            // 还原表格的样式
            var tableItems = document.querySelectorAll('.red-item, .black-item, .zero-item, .column-item, .doz-item, .outside-section');
            tableItems.forEach(function(item) {
                item.style.backgroundColor = '';
                item.style.color = 'white';
            });

            // 重置下注数目和更新钱包显示
            Betcount = 0;
            updateWalletDisplay();

            // 还原籌碼按鈕的狀態
            var chipButtons = document.querySelectorAll('.Butt');
            chipButtons.forEach(function(button) {
                button.style.backgroundColor = '';
                button.style.color = 'white';
            });
        }
    

    //輪盤part
        var options = ["0","1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18","19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36"];

        var startAngle = 0;
        var arc = Math.PI / (options.length / 2);
        var spinTimeout = null;

        var spinArcStart = 10;
        var spinTime = 0;
        var spinTimeTotal = 0;

        var ctx;

        document.getElementById("spin").addEventListener("click", spin);

        function byte2Hex(n) {
            var nybHexString = "0123456789ABCDEF";
            return String(nybHexString.substr((n >> 4) & 0x0F,1)) + nybHexString.substr(n & 0x0F,1);
        }

        function RGB2Color(r,g,b) {
            return '#' + byte2Hex(r) + byte2Hex(g) + byte2Hex(b);
        }

        function getColor(item, maxitem) {
            var phase = 0;
            var center = 128;
            var width = 127;
            var frequency = Math.PI*2/maxitem;

            if (item === 0) {
                // 綠色
                return '#00FF00';
            } else if (item % 2 === 0) {
                // 偶數紅色
                return '#FF0000';
            } else {
                // 奇數黑色
                return '#000000';
            }
        }

        function drawRouletteWheel() {
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var outsideRadius = 200;
                var textRadius = 160;
                var insideRadius = 125;

                ctx = canvas.getContext("2d");
                ctx.clearRect(0,0,500,500);

                ctx.strokeStyle = "black";
                ctx.lineWidth = 2;

                ctx.font = 'bold 12px Helvetica, Arial';

                for(var i = 0; i < options.length; i++) {
                    var angle = startAngle + i * arc;
                    ctx.fillStyle = getColor(i);

                    ctx.beginPath();
                    ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
                    ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
                    ctx.stroke();
                    ctx.fill();
                    ctx.save();
                    ctx.fillStyle = "white";
                    ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius, 250 + Math.sin(angle + arc / 2) * textRadius);
                    ctx.rotate(angle + arc / 2 + Math.PI / 2);
                    var text = options[i];
                    ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
                    ctx.restore();
            } 

            //Arrow
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.moveTo(250 - 4, 250 - (outsideRadius + 5));
            ctx.lineTo(250 + 4, 250 - (outsideRadius + 5));
            ctx.lineTo(250 + 4, 250 - (outsideRadius - 5));
            ctx.lineTo(250 + 9, 250 - (outsideRadius - 5));
            ctx.lineTo(250 + 0, 250 - (outsideRadius - 13));
            ctx.lineTo(250 - 9, 250 - (outsideRadius - 5));
            ctx.lineTo(250 - 4, 250 - (outsideRadius - 5));
            ctx.lineTo(250 - 4, 250 - (outsideRadius + 5));
            ctx.fill();
        }
        }

        function spin() {
            // 檢查 Betcount 是否為0//為0的話表示下注失敗
            if (Betcount === 0) {
                window.alert("下注失敗");
                resetTable();
                return;
            }

            spinAngleStart = Math.random() * 10 + 10;
            spinTime = 0;
            spinTimeTotal = Math.random() * 3 + 4 * 1000;
            rotateWheel();
            
            }

        function rotateWheel() {
            spinTime += 30;
            if(spinTime >= spinTimeTotal) {
                stopRotateWheel();
                return;
            }
            var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
            startAngle += (spinAngle * Math.PI / 180);
            drawRouletteWheel();
            spinTimeout = setTimeout('rotateWheel()', 30);
        }

        function stopRotateWheel() {
            clearTimeout(spinTimeout);
            var degrees = startAngle * 180 / Math.PI + 90;
            var arcd = arc * 180 / Math.PI;
            var index = Math.floor((360 - degrees % 360) / arcd);
            ctx.save();
            ctx.font = 'bold 30px Helvetica, Arial';
            var text = options[index]
            ctx.fillText(text, 250 - ctx.measureText(text).width / 2, 250 + 10);
            ctx.restore();

            setTimeout(function() {
                Bet(options[index]); // Call Bet function after a delay
            }, 1000); // 1000 milliseconds delay for the animation to complete
        }

        function easeOut(t, b, c, d) {
            var ts = (t/=d)*t;
            var tc = ts*t;
            return b+c*(tc + -3*ts + 3*t);
        }

        drawRouletteWheel();

        window.onload = function() {
        // 在程式剛開始時呼叫 init()
        initBetrecord();
    };
    </script>
  </body>
</html>
